/*! canal 2014-11-11 */
Object.keys||(Object.keys=function(){"use strict";var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){if("object"!=typeof e&&("function"!=typeof e||null===e))throw new TypeError("Object.keys called on non-object");var f,g,h=[];for(f in e)a.call(e,f)&&h.push(f);if(b)for(g=0;d>g;g++)a.call(e,c[g])&&h.push(c[g]);return h}}());var canal;!function(a){function b(a){if("string"!=typeof a)throw new TypeError("You must provide a string to create or get a topic");return g[a]||(g[a]=new f(a)),g[a]}function c(a,b){return h.publish(a,b)}function d(a,b){return h.subscribe(a,b)}var e=function(){function a(a,b,c){this.id=a,this.validator=b,this.callback=c}return a}(),f=function(){function a(a){this.name=a,this.nodeIdCount=0,this.identifierToValidatorDict={},this.identifierToSubscriptionNodesDict={}}return a.prototype.makeValidatorKey=function(a){if(Object(a)!==a)throw new TypeError("Cannot make a validator key without an object");var b=Object.keys(a),c=b.sort(),d=c.map(function(b){var c={};return c[b]=a[b],c});return JSON.stringify(d)},a.prototype.getOrMakeValidator=function(a){if(Object(a)!==a)throw new TypeError("Cannot get or make validator without an object");var b=this.makeValidatorKey(a),c=this.identifierToValidatorDict[b];return c||(c=function(b){if(Object(b)!==b)throw new TypeError("You must pass a valid identifier to compare against a subscription.");for(var c in a)if(a.hasOwnProperty(c)){if(!b.hasOwnProperty(c))return!1;if(b[c]!==a[c])return!1}return!0},this.identifierToValidatorDict[b]=c),c},a.prototype.publish=function(a,b){if(Object(a)!==a)throw new TypeError("You must publish with an object");for(var c in this.identifierToValidatorDict)if(this.identifierToValidatorDict.hasOwnProperty(c)&&this.identifierToValidatorDict[c](a)){var d=this.identifierToSubscriptionNodesDict[c];if(d&&d.length>0)for(var e=0;e<d.length;e++)d[e].callback(b)}},a.prototype.subscribe=function(a,b){if(Object(a)!==a)throw new TypeError("You must subscribe with an object");var c=this.makeValidatorKey(a),d=new e(++this.nodeIdCount,this.getOrMakeValidator(a),b);return this.identifierToSubscriptionNodesDict[c]||(this.identifierToSubscriptionNodesDict[c]=[]),this.identifierToSubscriptionNodesDict[c].push(d),d.id},a}();a.Topic=f;var g={},h=new f("root");g.root=h,a.topic=b,a.publish=c,a.subscribe=d}(canal||(canal={}));