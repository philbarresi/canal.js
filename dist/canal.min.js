/*! canal 2014-11-12 */
Object.keys||(Object.keys=function(){"use strict";var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){if("object"!=typeof e&&("function"!=typeof e||null===e))throw new TypeError("Object.keys called on non-object");var f,g,h=[];for(f in e)a.call(e,f)&&h.push(f);if(b)for(g=0;d>g;g++)a.call(e,c[g])&&h.push(c[g]);return h}}());var canal;!function(a){function b(a){if(Object(a)!==a)throw new TypeError("Cannot make a validator key without an object");var b=Object.keys(a),c=b.sort(),d=c.map(function(b){var c={};return c[b]=a[b],c});return JSON.stringify(d)}function c(a){if("string"!=typeof a)throw new TypeError("You must provide a string to create or get a topic");if(0===a.length)throw new Error("Your topic name must not be null or empty.");return i[a]||(i[a]=new h(a)),i[a]}function d(a,b,c){return j.publish(a,b,c)}function e(a,b){return j.subscribe(a,b)}function f(){for(var a in i)i.hasOwnProperty(a)&&(i[a].delete(),delete i[a]);i={},j=new h("root"),i.root=j}var g=function(){function a(a,b,c){this.id=a,this.validator=b,this.callback=c}return a}(),h=function(){function b(a){this.name=a,this.nodeIdCount=0,this.identifierToValidatorDict={},this.identifierToSubscriptionNodesDict={}}return b.prototype.getOrMakeValidator=function(b){if(Object(b)!==b)throw new TypeError("Cannot get or make validator without an object");var c=a.makeValidatorKey(b),d=this.identifierToValidatorDict[c];return d||(d=function(a){if(Object(a)!==a)throw new TypeError("You must pass a valid identifier to compare against a subscription.");for(var c in b)if(b.hasOwnProperty(c)){if(!a.hasOwnProperty(c))return!1;if(a[c]!==b[c])return!1}return!0},this.identifierToValidatorDict[c]=d),d},b.prototype.publish=function(a,b,c){if(Object(a)!==a)throw new TypeError("You must publish with an object");for(var d in this.identifierToValidatorDict)if(this.identifierToValidatorDict.hasOwnProperty(d)&&this.identifierToValidatorDict[d](a)){var e=this.identifierToSubscriptionNodesDict[d];if(e&&e.length>0)for(var f=0;f<e.length;f++){var g=e[f];g.callback&&setTimeout(g.callback.bind(g,b),0)}}c&&"function"==typeof c&&c()},b.prototype.subscribe=function(b,c){if(Object(b)!==b)throw new TypeError("You must subscribe with an object");var d=a.makeValidatorKey(b),e=new g(++this.nodeIdCount,this.getOrMakeValidator(b),c);return this.identifierToSubscriptionNodesDict[d]||(this.identifierToSubscriptionNodesDict[d]=[]),this.identifierToSubscriptionNodesDict[d].push(e),e.id},b.prototype.reset=function(){for(var a in this.identifierToValidatorDict)delete this.identifierToValidatorDict[a];for(var a in this.identifierToSubscriptionNodesDict)this.identifierToSubscriptionNodesDict[a].length=0,delete this.identifierToSubscriptionNodesDict[a]},b.prototype.delete=function(){this.reset(),delete this.identifierToValidatorDict,delete this.identifierToSubscriptionNodesDict},b}();a.Topic=h;var i={},j=new h("root");i.root=j,a.makeValidatorKey=b,a.topic=c,a.publish=d,a.subscribe=e,a.init=f,f()}(canal||(canal={}));